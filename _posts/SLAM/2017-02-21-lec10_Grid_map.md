---
layout: post
title: '[SLAM] Grid Maps'
tags: [SLAM]
description: >
  Landmark 기반이 아닌 volumetric 기반의 grid map을 소개한다.
sitemap :
  changefreq : weekly
  priority : 1.0
---

**본 글은 University Freiburg의 [Robot Mapping](http://ais.informatik.uni-freiburg.de/teaching/ws13/mapping/) 강의를 바탕으로 이해하기 쉽도록 정리하려는 목적으로 작성되었습니다. 개인적인 의견을 포함하여 작성되기 때문에 틀린 내용이 있을 수도 있습니다. 틀린 부분은 지적해주시면 확인 후 수정하겠습니다.**

이번 글에서는 EKF와 EIF등과 같이 landmark나 feature를 기반의 map표현 방법이 아닌, 센서의 raw 데이터를 이용하여 volumetric하게 map을 표현하는 방법에 대해서 설명하도록 한다.

#### Feature

* EKF, EIF, SEIF는 feature 기반의 map을 사용한다.
* 센서 데이터를 그대로 사용하는 것이 아닌 compact한 표현 방법을 사용하여 map을 나타낸다.
* 많은 feature의 관측은 landmark의 위치 추정 정확도를 높인다.

#### Grid Map

* 공간을 cells로 나누어 표현한다.
* grid로 표현된 공간 구조는 고정이다.
* 각 cell은 occupied space와 free space로 구분된다.
* non-parametric model이다. 즉 센서데이터를 이용하여 landmark를 표현할 수 있는 parameter를 계산하지 않고 map을 표현한다.
* compact한 parameter로 map을 표현하지 않기 때문에 상당한 memory가 필요하다.
* feature detector에 의존하지 않는다.

<img align="middle" src="/images/post/SLAM/lec10_Grid_map/grid_map_ex.png" width="100%">

위 그림은 grid map을 보여준다.

### Grid map의 가정 1

첫번째 가정: cell을 구성하는 영역은 완전히 binary random variable로 occupied이거나 free이다.

* cell이 occupied: $$p(m_i) = 1$$
* cell이 free: $$p(m_i) = 0$$
* cell상태를 알수 없음: $$p(m_i) = 0.5$$

<img align="middle" src="/images/post/SLAM/lec10_Grid_map/assumption1.png" width="100%">

### Grid map의 가정 2

두번째 가정: map은 움직이지 않는다. 즉 static world이다. 대부분의 mapping system은 이러한 가정을 한다.

<img align="middle" src="/images/post/SLAM/lec10_Grid_map/assumption2.png" width="100%">


### Grid map의 가정 3

세번째 가정: map을 이루는 각 cell은 서로 독립적(independent)하다. 따라서 전체 map의 확률은 각 cell의 확률의 곱으로 계산되어진다.

$$
p(m) = \prod_i p(m_t)
$$

위 식에서 m은 map전체를 의미하며, $$m_i$$는 각 cell을 의미한다.

<img align="middle" src="/images/post/SLAM/lec10_Grid_map/assumption3.png" width="100%">


### Data를 이용한 Map의 추정

주어진 센서 데이터 $$z_{1:t}$$와 로봇의 위치 $$x_{1:t}$$를 이용하여 map을 추정하면 다음과 같다.

$$
p(m \mid z_{1:t}, x_{1:t}) = \prod_i p(m_i \mid z_{1:t},x_{1:t})
$$

여기서 각 cell을 의미하는 $$m_i$$는 binary random variable이다.
각 cell의 확률을 계산하면 다음과 같다.

<img align="middle" src="/images/post/SLAM/lec10_Grid_map/cell_dist.png" width="100%">

위 식의 유도과정에는 bayes rule과 markov assumption이 사용된다. 위에서 계산된 $$p(m_i \mid z_{1:t},x_{1:t})$$는 cell이 occupied일 확률이며, cell이 free space일 확률을 구하면 다음과 같다.

<img align="middle" src="/images/post/SLAM/lec10_Grid_map/cell_dist_no.png" width="100%">

이제 위에서 구한 식을 이용하여 cell이 occupied확률을 계산해보자. 아래의 식과 같은 binary random variable의 특징을 보자.

$$
\begin{aligned}
\frac{p(x)}{1-p(x)} &= Y \\
p(x) &= Y - Yp(x)\\
p(x) (1+Y) &= Y\\
p(x) &= \frac{Y}{1+Y}\\
p(x) &= \frac{1}{1+\frac{1}{Y}}
\end{aligned}
$$

즉 binary random variable의 두 확률의 ration를 이용하면 각각의 probability를 계산할 수 있다. 이러한 특징을 이용하여 cell의 occupied확률을 계산해 보자.

$$
\frac{p(m_i \mid z_{1:t}, x_{1:t})}{p(\lnot m_i \mid z_{1:t}, x_{1:t})} = \frac{p(m_i \mid z_{1:t}, x_{1:t})}{1-p(m_i \mid z_{1:t}, x_{1:t})}
$$

<img align="middle" src="/images/post/SLAM/lec10_Grid_map/ratio.png" width="100%">

즉 probability를 정리하면 3개의 항으로 생각할 수 있다. 가운데 항은 각각 t-1시점과 t시점의 map을 의미하므로 recursive term으로 볼 수 있으며, 오른쪽 항은 맵에대한 prior term으로 볼 수 있다.

여기서 우리가 계산해야 하는 cell의 확률 $$p(m_i \mid z_{1:t},x_{1:t})$$을 효율적으로 계산하기 위해 Log odds notation을 이용한다.

#### Log odds notation

log odds notation은 다음과 같이 정의된다.

$$
l(m_i \mid z_{1:t},x_{1:t}) = log\big( \frac{p(m_i \mid z_{1:t},x_{1:t})}{1 - p(m_i \mid z_{1:t},x_{1:t})}\big)
$$

log odds notation을 이용하여 식을 정리하면 다음과 같다.

$$
l(m_i \mid z_{1:t},x_{1:t}) = l(m_i \mid z_t,x_t) + l(m_i \mid z_{1:t-1},x_{1:t-1}) - l(m_i)
$$

여기서 $$l(m_i \mid z_{1:t-1},x_{1:t-1})$$은 recursive하게 계산되는 항이며, $$l(m_i)$$은 prior 확률이다. 따라서 inverse sensor model인 $$l(m_i \mid z_t,x_t)$$가 계산된다면 효율적으로 단순한 더하기로 $$l(m_i \mid z_{1:t},x_{1:t})$$를 계산할 수 있다. 이렇게 계산된 log odds notation으로 부터 cell의 확률을 아래와 같이 계산할 수 있다.

$$
p(m_i \mid z_{1:t},x_{1:t}) = 1- \frac{1}{1+ exp(l(m_i \mid z_{1:t},x_{1:t}))}
$$


**본 글을 참조하실 때에는 출처 명시 부탁드립니다.**
